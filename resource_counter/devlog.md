# 230326 v0
여러가지 문제가 많았다. 이 프로그램을 파이썬 프로젝트에서 패키지처럼 불러와 사용할 수 있으면 참 좋을텐데, 그런 방법은 없고 프로그램에 종속적으로 돌아가야한다. 프로그램이 가진 한계는 지금까지 파악한 바로는 이렇다:
1. 이미지(에셋)이 액션의 목록을 가지고, 스크립트를 실행하는 액션이라면 해당 타이밍에 불린 뒤 소멸한다.
   * 따라서 상태나 종합정보 등을 저장할 수는 없다. lua에 전역변수로 저장해둔다면 될 수도 있겠지만...
   * 이미지가 자원이 아닌 주체이기 때문에 구성이 좀 빡세다
2. OCR전용 이미지는 클릭이나 표시가 따로 안되며, 코드에서 ROI를 구성한걸 화면에 확인해서 디버깅하려해도 GUI에서 제공하는 영역표시 메서드를 스크립트에서는 사용할 방법이 없다.
3. python 스크립팅을 지원한대서 루아보다는 익숙하니 골랐는데, 루아를 지원하는 것에 비해 많이 부족하다. 제공하는 기초적인 메서드 `imax.lua()`, `imax.lua_get_value()`, `imax.lua_set_value()`만으로 해결은 가능하지만 코드퀄리티를 유지하거나 확장성있게 구성하기가 어렵다.
   * 따라서 lua 스크립트와 브릿지 역할을 해 주는 스크립트를 따로 작성해야 한다. 그런데...
   * 이미지가 자원이 아닌 리소스이며 스크립트가 매 액션마다 단일 execution인게 파이썬만 그런건지 루아도 그런건지 알 수 없다.
   * 일단은 IMax 개발자분께 문의는 드려보는데, 당장은 좀 더러운 코드를 짜겠다는 각오가 필요할 것 같다.

아마 이러한 문제는 내가 스탠드얼론 앱이 아닌 프로그램 내부에서 돌아가는 개별 스크립팅을 하는게 익숙치 않기 때문일 것이다..

당장 원하는 기능을 구현하기 위해 풀이한 것은 아래와 같다:
1. 액션만을 실행하는 단일 에셋을 추가하고 거기에 엔트리포인트 역할을 하는 스크립트를 추가했다. 여기에서 원래라면 이미지 에셋의 순서대로 구성했을 듯한 진행식을 작성한다.
2. 정말정말 하고싶지 않았지만 `importlib`를 통한 런타임 임포트를 추가해서 돌아가게 했다. Aㅏ...
   * 하지만 일단 나는 기능이 돌아가게 만드는게 첫번째라고 생각하는 사람이라 정리는 나중에 할 생각이다.
3. lua_helper 로 루아 스크립트에 직접 접근하는걸 일단 몰아뒀다. 어느 정도의 비즈니스로직이 침범하는건 당장은 감수해야 할 듯 하다.
4. 아주 대충 스테이트 구문을 만들어서 메인->옵션->아이템->뒤로->장비 순으로 순회하는걸 만들었다.
5. 첫 번째 페이지에서 스크롤 없이 인식 가능한 목록만을 데이터로 만든 뒤 확인해봤다. 일단은 ok인데 예외처리는 좀 필요할 듯 하다.

내일 바꿔보거나 추가구현할 목록은 아래와 같다:
1. OCR방식 바꾸기.
   * 지금은 테이블의 각 아이템에 적힌 숫자를 OCR로 인식해서 사용한다. 하지만 갯수가 많아지면 `123k`등으로 간략화되기도 하고, 아이템 이미지와 겹쳐서 존재하기때문에 인식률이 떨어질 때가 있다.
   * 따라서 각 아이템을 인식시 클릭하고 갯수가 적힌 UI에서 OCR을 진행하도록 바꿀 생각이다. 오히려 이 편이 더 편하기도 하다.
2. 드래그해서 이미지를 찾는 과정이 필요하다.
   * 이것 관련해서 고민인게, 아이템 하나를 찾을 때까지 드래그를 전부 해버리는건 너무 비효율적일 것 같고, 또 어떤 절충안을 쓰자니 버그가 생길 여지가 많다. 일단은 돌아가게 구현한 뒤 바꿔야 하는 것인가? 내일 이거 만들기 전까지만 새 방식을 생각해보자.
3. 이미지를 스크린샷이 아닌 원본으로 인식시킬 수 있는 방법이 없나 확인해보기
   * 리소스플래너 사이트에서 이미지를 긁어왔는데, IMax 프로그램에서 하나하나 이미지 긁어다가 인식시키는게 참 귀찮다는 생각이 들어서... 인식률이 망가진다면 별 수 없는데 이걸로 해결됐으면 좋겠다.
4. id formatter 만들기
   * 이걸 만들게 된 계기가 된 사이트에 등록시키려면 해당 사이트 양식에 맞게 포매팅할 필요가 있다.
   * export해서 현재 데이터를 받아온 뒤
   * 현재 이 프로그램에서 인식한 아이템들의 갯수로 치환시키고
   * 다시 해당 사이트에서 import 가능하게 한다
   * 이 과정은 굳이 IMax 위에서 전부 이뤄질 필요는 없다. 그냥 포매팅한 결과만 파일로 출력하면 된다. 이걸 익숙한 방법으로 하기 위해 lua가 아니라 python을 쓴 거기도 하고...
5. 리소스 룩업 데이터 텍스트파일로 뽑기
   * 코드에 데이터컨테이너로 존재하는게 아니라 csv나 json으로 뽑아두는게 여러모로 좋을 것 같다는 생각이다.
   * csv는 확장성이 별로지만 이 기능에서 확장성이 필요한가? 아닐 것 같아서 이쪽으로 마음이 기운다.

# 230325 v0
https://justin163.com/planner/ 이 사이트를 이용하다가 보유한 아이템을 자동으로 세어주면 좋겠다는 생각을 했다.

fiddler로 프록시를 열고 해당 프록시에 앱플레이어를 연결해보았으나 proxycap을 먹인 블루스택 등이 아니면 리퀘스트를 받아올 수 없는 문제를 발견했다.
차선책으로 공유기에 노트북과 안드로이드 폰을 연결하고 동일한 방법을 사용해볼까 했지만, 그렇게 엔드포인트를 따온다고 확실하게 쓸 수 있다는 보장도 없고(권한 문제 등), 매번 authToken 뜯어와서 PC에서 리퀘 날리기도 귀찮을 것 같아서 일단 해당 방법은 포기했다.

차선책은 클라이언트 사이드에서 긁어오는 것이었는데, 이것도 영 방법이 귀찮은 것 밖에 안보이는 와중에 이미지매크로를 돌리고 OCR로 카운팅을 하면 어떨까 하는 생각에 검색해보니 ImageMax라는 프로그램이 적당히 사용할만해보여 고르게 됐다.

### 필요한 동작
1. 실행시 톱니바퀴 클릭
2. '아이템' 버튼을 클릭해서 진입
   1. 갖고있는 보고서 카운팅
   2. 갖고있는 오파츠 카운팅
   3. 갖고있는 BD 카운팅
   4. 갖고있는 기술교본 카운팅
   5. 이 과정에서 드래그 사용, OCR로 숫자 인식
3. 뒤로가기로 이전 메뉴로 귀환
4. '장비' 버튼을 클릭해서 진입
   1. 갖고있는 경험치 아이템 카운팅
   2. 갖고있는 T2이상 설계도 갯수 카운팅
5. 퇴장
6. 카운팅된 아이템들을 리소스플래너 형식에 맞게 포매팅

### 해야할 일들
1. 인식할 이미지 표본 따기
2. 버튼 인식 과정 구현
3. UI 진입후 인식 활성/비활성 트리거링
4. 드래그하며 카운팅
5. 결과값 File I/O